{% extends 'base.html' %}

{% block page_title %}Ultime novit√†{% endblock %}

{% block content %}
  <div id="blog">

    {% for object in object_list %}
      {% include 'entry_item.html' with object=object title_linked=1 only %}
    {% endfor %}

  </div>

  {% block javascript %}

    {{ block.super }}
    <script type='text/javascript'>//<![CDATA[
      $(window).load(function() {
        var blog = $('#blog');

        var loaded = [];

        blog.on('click', 'article header a', function() {
          var article = $(this).closest('article');
          var slug = article.attr('id');

          blog.find('article').not(article).find('header').siblings().hide();

          if ($.inArray(slug, loaded) == -1) {
            $.ajax({
              url: '{% url "blog_item_load" "--" %}'.replace('--', slug),
              success: function(data) {
                article.replaceWith(data);
                loaded.push(slug);
                location.href = '#' + slug;
              }
            });
          } else {
            article.find('header').siblings().toggle();
            if (article.find('header').next().is(':visible')) {
              location.href = '#' + slug;
            }
          }

          return false;
        });

        hash = location.hash.replace('#', '');
        if (hash) {
          blog.find('article#'+hash+' header a').trigger('click');
        } else {
          blog.find('article:first header a').trigger('click');
        }
      });//]]>
    </script>
  {% endblock javascript %}
{% endblock content %}

