{% extends 'base_map.html' %}
{% load i18n %}
{% load staticfiles %}
{% load idioticon %}
{% load icons %}
{% load humanize %}
{% load crs %}

{% block content %}
    <div class="row">
        <div class="container">
            <div class="col-md-7">
                <h2><a href="{% url 'cooperazione_italiana' %}">{% trans 'Italian Development Cooperation' %}</a></h2>

                <p>
{% blocktrans %}Since the 1950s, Italian Development Cooperation has grown through aid programs in
countries linked to Italy by former colonial ties.
Italy has developed a more systematic cooperative approach aimed at alleviating poverty worldwide
and helping developing countries to strengthen their institutions and governance.
In recent years, due to new global plights, Italian Cooperation has played a crucial role in
defining Italian foreign policy,
aimed at maintaining peace and managing migration flows.{% endblocktrans %}
                    <a href="{% url 'cooperazione_italiana' %}"
                       class="read-more pull-right twelve">{% trans 'read more' %} {% icon 'caret-right' %}</a>
                </p>

            </div>

            <div class="col-md-5">
                <h2><a href="{% url 'blog_home' %}">{% trans "News" %}</a></h2>

                <ul class="media-list home-blog">
                    {% for entry in entries_list %}
                        <li class="media">
                            <article class="media-body">
                                <header>
                                    <a href="{% url 'blog_item' entry.slug %}">{{ entry.title }}</a>
                                </header>
                                <div class="text">
                                    {{ entry.abstract|safe }}
                                </div>
{#                                <footer>#}
{#                                    <time datetime="2014-05-06 19:00">{{ entry.published_at|date:'d/m/Y' }}</time>#}
{#                                </footer>#}
                            </article>
                        </li>
                    {% endfor %}
                </ul>

            </div>
        </div>
        <!-- .container -->
    </div><!-- .row -->

    <div class="spacer"></div>

    {% crs_stats %}

    <div class="row">
        <div class="col-md-8">
            {% include 'commons/top_projects.html' with top_projects=top_projects %}
        </div>

        <div class="col-md-4">
            <h2>{% trans 'Focus on' %}</h2>
            {% if project_focus %}
            <div class="row">
                <div class="col-md-12">
                    <div class="focus">
                        <div class="spacer"></div>
                        <div class="row no-marg">
                            {% with p_total_commitment=project_focus.total_commitment|default:0 p_total_disbursement=project_focus.total_disbursement|default:0 %}
                            <div id="pie4" data-chart="pie" data-values="{{ p_total_commitment }}|{{ p_total_disbursement }}"></div>
                            <div class="col-md-4 numbers bg-red bordered-radius small-pad">{% if p_total_commitment %}€
                                {{ p_total_commitment|currency }}{% else %}-{% endif %}<br><span class="eleven">{% trans 'Committed' %}</span></div>
                            <div class="col-md-4 col-md-offset-1 numbers bg-blue bordered-radius small-pad">{% if p_total_disbursement %}€
                                {{ p_total_disbursement|currency }}{% else %}-{% endif %}<br><span class="eleven">{% trans 'Used' %}</span></div>
                            {% endwith %}
                        </div>
                        <div class="row no-marg">
                            <h3><a href="{% url 'projects:project-detail' pk=project_focus.pk %}">{{ project_focus.title }}</a></h3>
                            {% for recipient in project_focus.recipients|unique %}
                                <a href="{% url 'codelists:recipient-detail' code=recipient.code %}">{{ recipient.name }}</a>
                            {% endfor %}
                             <span class="light-gray eleven">{{ project_focus.start_year }}-{{ project_focus.end_eyar }}</span>
                        </div>
                        <div class="small-spacer"></div>
                        {% with photo_set=project_focus.photo_set.all %}{% if photo_set|length > 0 %}
                        <ul class="gallery gallery-small">
                            {% for photo in photo_set %}{% if forloop.counter <= 3 %}
                            <li><img src="{{ photo.file.url }}"></li>
                            {% endif %}{% endfor %}
                        </ul>
                        <div class="spacer"></div>
                        {% endif %}{% endwith %}
                        <div class="row no-marg">
                            <div class="col-md-6">
                                <h4>{% trans 'Agency' %}</h4>
                                <p class="small-paragraph">{{ project_focus.agency }}</p>
                            </div>
                            <div class="col-md-6">
                                <h4>{% trans 'Channel reported' %}</h4>
                                <p class="small-paragraph">{{ project_focus.channel_reported|default_if_none:'-' }}</p>
                            </div>
                        </div>
                        {% if project_focus.description %}
                        <div class="row no-marg project-description">
                            <div class="col-md-12">
                                <h4>{% trans 'Description' %}</h4>
                                <p class="readmore small-paragraph" data-max-height="40">
                                    {{ project_focus.description|safe }}
                                    <a href="#" class="readmore-open">{% trans 'read more' %} {% icon 'caret-down' %}</a>
                                    <a href="#" class="readmore-close">{% trans 'close' %} {% icon 'caret-up' %}</a>
                                </p>
                            </div>
                        </div>
                        {% endif %}

                        <ul class="nav nav-pills top-dotted">
                            {% for sector in project_focus.sectors|unique %}
                            <li>
                                <a href="{% url 'codelists:sector-detail' code=sector.get_root.code %}">{% icon 'chevron-right' %}{{ sector.get_root.name }}</a>
                            </li>
                            {% endfor %}
                        </ul>

                        <div class="row no-marg">
                            <div class="col-md-6">
                                <span class="eleven light-gray block">{% trans 'Aid type' %}</span>
                                {% for aid_type in project_focus.aid_types|unique %}{% if aid_type %}
                                <a href="{% url 'codelists:aid_type-detail' code=aid_type.code %}" class="eleven">{{ aid_type.name }}</a>{% if not forloop.last %}, {% endif %}
                                {% endif %}{% endfor %}
                            </div>
                            <div class="col-md-6">
                                <span class="eleven light-gray block">{% trans 'Channels' %}</span>
                                {% for channel in project_focus.channels|unique %}{% if channel %}
                                <a href="{% url 'codelists:channel-detail' code=channel.code %}" class="eleven">{{ channel.name }}</a>{% if not forloop.last %}, {% endif %}
                                {% endif %}{% endfor %}
                            </div>
                        </div>
                    </div>
                    <!-- .focus -->
{#                    <div class="like"><img src="{% static 'img/layout/like.jpg' %}" class="pull-left"></div>#}
                </div>

            </div>
            {% endif %}

        </div>
    </div><!-- .row -->

{% endblock %}

{% block modal %}
{{ block.super }}
<div class="modal fade" id="welcomeModal" tabindex="-1" role="dialog" aria-labelledby="welcomeModalLabel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{% trans 'close' %}</span></button>
                <h4 class="modal-title" id="welcomeModalLabel">{% trans "WELCOME TO OPEN AID ITALIA" %}</h4>
            </div>
            <div class="modal-body">
{% blocktrans %}<p>This website aims at making data on Italian Development Aid available for all.</p>
<p>The website is in its first development phase, involving the on-line publication of all data on Italian ODA since 2004.</p>
<p>In the second phase, the website will be integrated with additional contents on individual initiatives and with further information on different development actors.</p>
<p>In the third phase different actors will be enabled to contribute to the website by publishing contents on the initiatives they are involved in.</p>
<p>In the fourth phase, the website will provide detailed information also on other sources of financing for development, in order to provide a comprehensive picture of the Italian commitment to development.</p>
<p>We are at the beginning of a challenging project: keep following us!</p>{% endblocktrans %}
                <div class="text-right"><a href="#" class="text-muted" data-dismiss="modal">{% trans 'close' %}</a></div>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
{% endblock modal %}

{% block javascript %}
{{ block.super }}
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            if ($.cookie('welcome-modal') == null || location.hash == '#welcome') {
                $('#welcomeModal').modal('show');
                $.cookie('welcome-modal', 7);
            }
        });
    </script>

{% endblock %}